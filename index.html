<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Asstrallity Mods</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bower-qt-qwebchannel/5.15.0/qwebchannel.js"></script>

    <style>
        /* Тот же красивый стиль */
        body { background: #0e0f12; color: #fff; font-family: 'Roboto', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; user-select: none; }
        .sidebar { width: 260px; background: #15161a; padding: 25px; display: flex; flex-direction: column; border-right: 1px solid #25262b; }
        .logo { font-family: 'Rajdhani', sans-serif; font-size: 28px; color: #ff5500; margin-bottom: 40px; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .content { flex: 1; padding: 30px; overflow-y: auto; }
        
        .mod-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .mod-card { background: #1c1e24; border-radius: 10px; overflow: hidden; transition: 0.3s; border: 1px solid transparent; }
        .mod-card:hover { transform: translateY(-5px); border-color: #ff5500; box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        
        .mod-img { width: 100%; height: 170px; object-fit: cover; background: #000; }
        .mod-body { padding: 20px; }
        .mod-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .mod-desc { font-size: 13px; color: #888; height: 36px; overflow: hidden; margin-bottom: 15px; line-height: 1.4; }
        
        .btn { 
            width: 100%; padding: 12px; border: none; border-radius: 6px; 
            background: #ff5500; color: white; font-weight: bold; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: 0.2s; 
        }
        .btn:hover { background: #ff7722; }
        .btn:active { transform: scale(0.98); }

        /* Статус */
        .status-box { margin-top: auto; font-size: 12px; color: #666; border-top: 1px solid #25262b; padding-top: 15px; }
        .status-val { color: #00ff88; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-cube"></i> ASSTRALLITY</div>
        <div class="status-box">
            <div>Связь с Python: <span id="conn-status" style="color:#555">Нет</span></div>
            <div style="margin-top:5px">Игра: <span id="game-status">Поиск...</span></div>
        </div>
    </div>

    <div class="content">
        <h2 style="font-family:'Rajdhani'; margin-bottom:25px">ДОСТУПНЫЕ МОДЫ</h2>
        <div id="grid" class="mod-grid">
            <div style="color:#666">Загрузка списка с GitHub...</div>
        </div>
    </div>

    <script>
        // НАСТРОЙКИ РЕПОЗИТОРИЯ
        const REPO_ROOT = "https://raw.githubusercontent.com/asstrallity-ui/Tanks_Blitz_Mods_Files/main/";
        const MODS_JSON = REPO_ROOT + "mods.json";
        
        let backend = null;

        // 1. Сразу качаем JSON (сайт сам тянет)
        fetch(MODS_JSON)
            .then(res => res.json())
            .then(data => renderMods(data))
            .catch(err => {
                document.getElementById('grid').innerHTML = `<div style="color:red">Ошибка загрузки JSON: ${err}</div>`;
            });

        function renderMods(mods) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            mods.forEach(mod => {
                // Формируем полные ссылки
                // Если в JSON путь "Mods/BZ...", то приклеиваем его к REPO_ROOT
                const fileUrl = REPO_ROOT + mod.file; 
                const imgUrl = mod.image.startsWith('http') ? mod.image : REPO_ROOT + mod.image;

                const card = document.createElement('div');
                card.className = 'mod-card';
                card.innerHTML = `
                    <img src="${imgUrl}" class="mod-img" onerror="this.src='https://via.placeholder.com/300?text=Error'">
                    <div class="mod-body">
                        <div class="mod-title">${mod.name}</div>
                        <div class="mod-desc">${mod.description}</div>
                        <button class="btn" onclick="install('${fileUrl}')">
                            <i class="fas fa-download"></i> УСТАНОВИТЬ
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // 2. Подключаем Python для функционала
        document.addEventListener("DOMContentLoaded", () => {
            if (typeof QWebChannel !== 'undefined') {
                new QWebChannel(qt.webChannelTransport, (channel) => {
                    backend = channel.objects.backend;
                    
                    // UI обновления
                    document.getElementById('conn-status').innerText = "Активно";
                    document.getElementById('conn-status').style.color = "#00ff88";
                    
                    // Просим путь к игре (чисто для инфо)
                    backend.requestGamePath();
                });
            }
        });

        // 3. Отправляем прямую ссылку в Python
        function install(url) {
            if(backend) {
                backend.doInstall(url);
            } else {
                alert("Запустите через Python-лаунчер!");
            }
        }

        function setGameStatus(path) {
            const el = document.getElementById('game-status');
            el.innerText = path ? "Найдена" : "Не найдена";
            el.style.color = path ? "#00ff88" : "#ff3333";
        }
    </script>
</body>
</html>
